# 주가 데이터 Back-Testing을 통한 투자 기법 검증 및 예측

## 1. 과제 개요
### 가. 과제 선정 배경 및 필요성
코로나 사태 이후 증시와 은행 예금으로 동시에 자금이 대거 유입되고 있다. 정부와 한국은행의 적극적인
유동성 공급 정책으로 시중 자금이 급증한 가운데, 이 돈이 '모(투자 위험이 큰 주식) 아니면 도(안전한 예
금)'로 몰리고 있는 것이다. 특히 최근 증시로의 민간 자금 유입은 3월 29일 45조 원(개인 투자자의 예탁금 규모)으로 역대 최대기록을
달성하였고, 이는 언론에서는 '동학개미운동' 이라는 말로 대서특필할 정도로 전례 없던 규모이다. 그러나
증시에 대한 개인 투자자들의 관심과 자금 유입에 비해, 개인 투자자들의 증시 관련 정보나 지식 수준은 그
에 미치지 못하는 실정이다.
### 나. 과제 주요 내용
1) 군집 분석을 통해 유사한 주가 흐름을 보이는 종목들을 Clustering
2) 기업의 Fundamental, 주가의 추세와 거래량 등 기본적, 기술적 분석 요소에 기반한 통계 분석
3) 가장 예측 확률이 높은 분석 지표 찾아내기(또는 새로운 지표 만들어내기)
4) RNN 등의 AI를 통한 주가 예측

## 2. 과제의 목표
### 가. 최종결과물의 목표 
 1) KOSPI 전 기업에 대해 유사한 주가 흐름을 보이는 기업들을 Clustering 후 그룹화
 2) 각 Cluster에 대해 10여 가지의 기본적, 기술적 분석 기법을 적용하여 투자 기법의 유효성 검증
 3) 예측 확률이 높은 분석 지표를 찾아내고, 여러 지표를 조합한 새로운 투자 지표 제안
 4) 새로운 투자 지표와 RNN 등 AI에 기반한 주가 예측 시스템 구현
### 나. 최종결과물의 세부내용 및 구성
 1) KOSPI 전 기업에 대해 Clustering이 진행된 결과
 가) 산업군, 관련주 등으로 Segmentation 완료, 10여 개 정도의 Segment가 생길 것으로 예상됨
 2) Cluster 각각에 여러 분석 기법을 적용하였을 때의 결과
 가) 기본적 분석 기법을 통한 분석 결과
 나) 기술적 분석 기법을 통한 분석 결과
 다) Grid Search를 통한 분석 기법 별 최적의 투자 기간이 최종적으로 정해짐
 3) 분석 기법 적용 결과를 요약하고 가장 예측 확률이 높은 분석 지표 제시
 4) 기존의 지표들을 배제하고 새로운 metric을 적용한 새로운 투자 지표 제시
 ex) VIX 지수 : S&P500 옵션 가격의 향후 30일 동안의 변동성에 대한 시장의 기대를 나타내는
 지수
 5) 새로운 투자 지표와 RNN 등 AI를 기반으로 예측을 진행한 과정과 결과를 요약
 
## 3. 기대효과 및 활용방안
### 가. 기대효과
 1) 개인 투자자들의 투자 인사이트 획득을 통한 현명한 의사결정을 유도할 수 있다.
 2) 개인 투자자들과 기관-외인 투자자들 간의 정보 불균형을 해소할 수 있다.
### 나. 활용방안
 1) 투자 기법을 직접 back-testing할 수 있는 웹 서비스를 제공함으로써 접근성을 강화할 수 있다.
 2) 주가 예측, 시장의 향방 예측 등 새로운 지표를 기반으로 한 다양한 예측이 가능하다.
 
## 4. 수행방법
 0) 활용장비 : AI 학습 시 Titan Server GPU 대여 예정 (SW중심대학사업단)
  (장비 대여 불가 시) Google Colab, Kaggle 등 Cloud 컴퓨팅 서비스
 1) 주가 분석에 쓰일 변수들을 선별하기 위한 회귀분석 및 구조방정식 설계
 2) K-means Clustering을 활용한 Segmentation
 3) Elbow Analysis를 통한 클러스터 평가
 4) 재무제표를 통한 기본적 분석, 주가 데이터를 통한 기술적 분석 방법론
 5) 새로운 지표를 input으로, 미래 주가를 output으로 하는 LSTM, python 기반의 AI modeling
 
 
 # 데이터분석 캡스톤디자인 연구 진행 상황


## 1. 데이터 셋 확보

### 1) 변수 데이터 셋

![image](https://user-images.githubusercontent.com/44190559/95221852-d7fcfb80-0832-11eb-9072-1c3cd2fcdb3f.png)
![image](https://user-images.githubusercontent.com/44190559/95482544-3bb92d00-09c9-11eb-85bb-30343330df8a.png)


- 향후 머신 러닝에 사용될 수 있는 변수 데이터 셋을 확보
1. 원달러환율 : KO-US Exchange, 일별 원/달러 환율 
2. 거래대금 : KOSPI 시장 전체에서 거래된 주식의 일별 총 거래대금 (단위 : 1억원)
3. 외국인 순매수 : KOSPI 시장 전체에서 외국인의 일별 총 순매수량 (단위 : 1억원)
4. 전체시총 : KOSPI 시장의 일별 전체 시가총액 (단위 : 1억원)
5. 분기별 매출, 영업이익 데이터

### 2) 주가 데이터 셋

![image](https://user-images.githubusercontent.com/44190559/95221672-abe17a80-0832-11eb-8701-89d5e04181c3.png)


- 2016년 1월 초부터 현 시점까지의 약 5년 분량의 주가 데이터 (2016.01.04 ~ 2020.09.29)
- Yahoo Finance API를 이용하여 코스피 전 종목(795개)에 대한 데이터 수집

## 2. 전처리


![image](https://user-images.githubusercontent.com/44190559/95222009-0549a980-0833-11eb-8fdd-5d561ffb6e65.png)

- 변수 및 주가 데이터 셋에 대한 Min-Max Normalization을 수행하였고 모든 데이터가 0~1 사이의 값으로 변환됨
- Null 값은 제거

## 3. Clustering

### 주가 데이터 클러스터링

- 일별 가격을 기준으로 클러스터링 진행 ( 날짜 하나하나가 attribute가 되는 것)
- K-Means Clustering을 이용하였으며 최적의 클러스터 개수 선정에는 Elbow Model을 이용(SSE를 최소화하는 개수 선정)
- **Elbow Model을 통한 클러스터 평가** → SSE 감소 비율이 급격히 작아지는 시점인 4 선정, 클러스터의 개수 4개로 선정

![image](https://user-images.githubusercontent.com/44190559/95222130-23afa500-0833-11eb-97bb-42fda42dd520.png)


- Clustering 결과


![image](https://user-images.githubusercontent.com/44190559/95222201-375b0b80-0833-11eb-9a94-fc23f4c49349.png)

- 클러스터 별로 일별 주가를 평균을 낸 후 하나의 그래프에 도식한 결과
- 최적의 클러스터를 4개로 가정하고 분류하였으므로 각 클러스터는 다양한 섹터(제조, 화학 등)이 섞여 있음. 기존의 산업군 기반 분류는 종목을 약 20여 가지 섹터로 분류하였음
- 그러나 클러스터 내부 종목들의 주가 흐름은 유사하다고 할 수 있음

![image](https://user-images.githubusercontent.com/44190559/95532857-97f96c80-0a1c-11eb-91fb-d12d590359e0.png)

- 클러스터 각각을 구성하고 있는 산업의 구성 비중 확인

![image](https://user-images.githubusercontent.com/44190559/95222252-45a92780-0833-11eb-9a5a-bbb419e6426a.png)

- 클러스터, 변수 간 상관관계 분석
- 클러스터마다 상관관계가 큰 변수가 제각기 다른데, 클러스터와 선형적으로 유사한 변수를 향후 머신러닝 모델에 활용할 수 있을 것으로 사료됨

## 4. Back-Testing을 통해 검증할 투자 기법 정리
#### 기본적 분석 기법
- PER에 따른 주가의 변화 양상

#### 기술적 분석 기법
- 볼린저 밴드
- 상승VI, 하한VI
- 이동평균
- 캔들 차트

## 5. 다음 주까지 수행할 내용
- 변수 데이터 재조합을 통한 분석 기법 데이터 확보
- Cluster 별 투자 기법의 유효성 검증
- 투자 기법 별 최적의 투자 기간 선정(Grid Search)
 
 
